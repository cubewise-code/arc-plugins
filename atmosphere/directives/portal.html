<div class="atmosphere-portal-container h-100 d-flex flex-column" id="{{id}}-atmosphere-portal-container">
  <!-- Main Toolbar -->
  <div class="pb-3">
    <arc-toolbar large="$root.uiPrefs.atmospherePortalBigButtons">
      <arc-toolbar-group>
        <arc-toolbar-button arc-text="ATMOSPHEREPORTALBUTTONLABELCONNECTIONS"
          arc-title="ATMOSPHEREPORTALBUTTONTITLECONNECTIONS" arc-icon-class="fa-exchange"
          arc-click="showConnectionsDialog()" arc-icon-states="{}" arc-icon-state="{{ global.state }}">
        </arc-toolbar-button>
        <arc-toolbar-button arc-text="REFRESH" arc-title="REFRESH" arc-icon-class="fa-refresh" arc-click="refresh()"
          arc-icon-states="{ executing: iconStates.refreshing, disabled: iconStates.disabled }"
          arc-icon-state="{{ hasAtmosphere ? (executionStatus ? 'executing' : null) : 'disabled' }}">
        </arc-toolbar-button>
      </arc-toolbar-group>
      <arc-toolbar-group>
        <arc-toolbar-dropdown arc-text="OPTIONS" arc-title="OPTIONS" arc-icon-class="fa-cog"
          arc-dropdown-alignment="right" arc-dropdown-width="280px">
          <arc-toolbar-dropdown-item
            arc-click="$root.uiPrefs.atmospherePortalBigButtons = !$root.uiPrefs.atmospherePortalBigButtons;"
            arc-dropdown-stay-open>
            <a href>
              <i class="fa fa-fw"
                ng-class="{ 'fa-expand': $root.uiPrefs.atmospherePortalBigButtons, 'fa-compress': !$root.uiPrefs.atmospherePortalBigButtons }"></i>
              <span translate="{{'LARGEBUTTONS' | translate}}"></span>
              <span class="pull-right mt-1 mr-2">
                <i class="fa fa-toggle-on pull-right" ng-if="$root.uiPrefs.atmospherePortalBigButtons"></i>
                <i class="fa fa-toggle-off pull-right" ng-if="!$root.uiPrefs.atmospherePortalBigButtons"></i>
              </span>
            </a>
          </arc-toolbar-dropdown-item>
          <arc-toolbar-dropdown-item arc-click="toggleCredentials()" arc-dropdown-stay-open>
            <a href>
              <i class="fa fa-fw fa-key"></i>
              <span translate="{{'ATMOSPHERELABELCLEARCREDENTIALS' | translate}}"></span>
              <span class="pull-right mt-1 mr-2">
                <i class="fa fa-toggle-on pull-right" ng-if="$root.uiPrefs.atmosphereStoreCredentials"></i>
                <i class="fa fa-toggle-off pull-right" ng-if="!$root.uiPrefs.atmosphereStoreCredentials"></i>
              </span>
            </a>
          </arc-toolbar-dropdown-item>
        </arc-toolbar-dropdown>
        <arc-toolbar-button arc-text="HELP" arc-title="HELP" arc-icon-class="fa-question-circle" arc-click="help()">
        </arc-toolbar-button>
      </arc-toolbar-group>
      <div class="btn-group ml-auto" ng-if="hasAtmosphere">
        <button class="btn btn-warning btn-message" ng-if="initialized && !executionStatus && !global.connection"
          ng-click="showConnectionsDialog()">
          <i class="fa fa-exclamation-triangle icon-left"></i>
          <span ng-bind-html="'ATMOSPHERELABELNOCONNECTIONSELECT' | translate: { instance: instance }"></span>
        </button>
        <button class="btn btn-info btn-message" ng-if="global.connection" ng-click="showConnectionsDialog()">
          <i class="fa fa-exchange"></i>
          <span
            ng-bind-html="'ATMOSPHERELABELCONNECTION' | translate: { instance: instance, connection: global.connection }"></span>
        </button>
      </div>
    </arc-toolbar>
  </div>

  <atmosphere-message-url-missing message = "atmosphereMessage" atmosphere-url="atmosphereUrl"></atmosphere-message-url-missing>

  <div class="flex-grow-1 d-flex justify-content-center align-items-center" ng-if="!initialized || executionStatus">
    <i class="fa fa-refresh fa-spin fa-fw fa-5x" style="margin-top: 50px;"></i>
  </div>

  <div ng-if="initialized && !executionStatus && !global.connection" translate="ATMOSPHERELABELNOCONNECTIONSET"
    translate-values="{ instance: instance }">
  </div>

  <!-- Main Tabset -->
  <uib-tabset active="tabIndex" class="flex-grow-1" ng-if="!executionStatus && hasAtmosphere && global.connection">
    <uib-tab class="h-100" ng-click="tabChanged('functions')">
      <uib-tab-heading>
        <span class="font-weight-bold">f(x)</span>
        <span translate="ATMOSPHERETABLABELFUNCTIONSANDPROCESSES"></span>
      </uib-tab-heading>
      <auto-height>
        <cubewise-atmosphere-functions is-active="global.activeTab == 'functions'" instance="instance"
          connection="global.connection" functions="global.functions">
        </cubewise-atmosphere-functions>
      </auto-height>
    </uib-tab>
    <uib-tab class="h-100" ng-click="tabChanged('history')">
      <uib-tab-heading>
        <i class="fa fa-fw fa-clock-o"></i>
        <span translate="ATMOSPHERETABLABELHISTORY"></span>
      </uib-tab-heading>
      <auto-height>
        <cubewise-atmosphere-usage-history is-active="global.activeTab == 'history'" instance="instance"
          connection="global.connection" functions="global.functionsUsage">
        </cubewise-atmosphere-usage-history>
      </auto-height>
    </uib-tab>
    <uib-tab class="h-100" ng-click="tabChanged('log')">
      <uib-tab-heading>
        <i class="fa fa-fw fa-list-alt"></i>
        <span translate="ATMOSPHERETABLABELLOGS"></span>
      </uib-tab-heading>
      <auto-height>
        <cubewise-atmosphere-logs is-active="global.activeTab == 'log'" instance="instance"
          connection="global.connection" functions="global.functionsLogs">
        </cubewise-atmosphere-logs>
      </auto-height>
    </uib-tab>
  </uib-tabset>
</div>